<!DOCTYPE HTML>
<!--
Prologue by HTML5 UP
html5up.net | @ajlkn
Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
Jekyll integration by Chris Bobbe | chrisbobbe.github.io
-->
<html><head><!-- Robots -->
  <meta name="robots" content="index, follow" /><link rel="canonical" href="http://localhost:4000/assets/md/fonc/notes9.html" /><!-- Title, description, author --><title>&lt;i class=&quot;fas fa-code-branch fa-2x&quot;&gt;&lt;/i&gt; Les macroexpensions | Informatique - ENSEIRB-Matmeca</title>
  <meta name="description" content="Cours d&#39;informatique du Semestre 6 de l&#39;ENSEIRB-MATEMCA, année 2019/2020" />
  <meta name="author" content="Delpeuch Sébastien" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="&lt;i class=&quot;fas fa-code-branch fa-2x&quot;&gt;&lt;/i&gt; Les macroexpensions | Informatique - ENSEIRB-Matmeca" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://localhost:4000/assets/images/t%C3%A9l%C3%A9chargement.svg" />
  <meta property="og:url" content="http://localhost:4000/assets/md/fonc/notes9.html" />
  <meta property="og:site_name" content="Informatique" />
  <meta property="og:description" content="Cours d&#39;informatique du Semestre 6 de l&#39;ENSEIRB-MATEMCA, année 2019/2020" />
  
  <!-- Styles -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js" defer></script><![endif]-->
  <link rel="stylesheet" href="/assets/css/main.css" />
  <!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->
  <!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css">

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" defer></script>
  <script src="/assets/js/jquery.scrolly.min.js" defer></script>
  <script src="/assets/js/jquery.scrollzer.min.js" defer></script>
  <script src="/assets/js/skel.min.js" defer></script>
  <script src="/assets/js/util.js" defer></script>
  <!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js" defer></script><![endif]-->
  <script src="/assets/js/main.js" defer></script>

</head><body><!-- Header -->
<div id="header">
  <div class="top"><!-- Logo -->
<div id="logo">
  <a href="http://localhost:4000/" id="home-link">
    <span class="image avatar48"><img src="/assets/images/t%C3%A9l%C3%A9chargement.svg" alt="Avatar of Delpeuch Sébastien" /></span>
    <h1 id="title">Informatique</h1>
    <p>ENSEIRB-Matmeca</p>
  </a>
</div><!-- Nav -->
<nav id="nav">
  <ul><li><a href="http://localhost:4000/" id="semestre-6-en-cours-link">
            <span class="icon fa-link">Semestre 6 - En cours</span>
          </a></li><li><a href="http://localhost:4000/Semestre_5.html" id="semestre-5-link">
            <span class="icon fa-check">Semestre 5</span>
          </a></li></ul>
</nav></div>
  <div class="bottom"><!-- Social Icons -->
<ul class="icons"><li><a href="https://github.com/Sdelpeuch" class="icon-b fa-github"><span class="label">GitHub</span></a></li><li><a href="mailto:sebastien.delpeuch@enseirb-matmeca.fr" class="icon fa-envelope"><span class="label">Email</span></a></li></ul>
</div>
</div>
<!-- Main -->
<div id="main">
	<!-- Page -->
	<article class="shade-two">
	  <div class="container">
			<header>
				<h2><i class="fas fa-code-branch fa-2x"></i> Les macroexpensions</h2></header><script type="text/javascript" async="" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p>Cours inspiré du
<a href="https://www.labri.fr/perso/myriam/Enseignement/Scheme/scheme.pdf">polycopié</a>
de <a href="https://www.labri.fr/perso/myriam/">Myriam Desainte-Catherine</a> &amp; <a href="https://www.labri.fr/perso/renault/working/index.php">David Renault</a>.</p>

<style>
html {
 zoom: 0.80;
}
</style>

<h2 id="-rappels-sur-lévaluation-et-lapplication"><i class="fas fa-code-branch"></i> Rappels sur l’évaluation et l’application</h2>

<h3 id="evaluation-application-texttteval-o-env">Evaluation application <script type="math/tex">\texttt{(eval o env)}</script></h3>

<p>Cette forme d’évaluation est utilisée pour toutes les fonctions construites avec
des <script type="math/tex">lambda</script>, <script type="math/tex">define</script>, <script type="math/tex">let</script> et <script type="math/tex">letrec</script>. C’est celle qui est mise en
oeuvre dans la plupart des langages de programmation, en particulier impératifs
<script type="math/tex">(C,Java)</script>. Soit <script type="math/tex">env</script> l’environnement courant</p>

<ul>
  <li>Si l’objet <script type="math/tex">o</script> est autoévaluant, renvoyer <script type="math/tex">o</script></li>
  <li>Si <script type="math/tex">o</script> est un symbole, alors
    <ul>
      <li>Rechercher une liaison définissant <script type="math/tex">o</script> dans <script type="math/tex">env</script>, renvoyer la référence
associée</li>
    </ul>
  </li>
  <li>Si <script type="math/tex">o</script> est une liste
    <ul>
      <li>Calculer <script type="math/tex">\texttt{(eval (car o) env)}</script>. Soit <script type="math/tex">f</script> la fermeture résultat</li>
      <li>Calculer <script type="math/tex">\texttt{(eval a env)}</script>, pour tout élément <script type="math/tex">a</script> de <script type="math/tex">\texttt{(cdr o)}</script>. soit
<script type="math/tex">v</script> la liste des résultats</li>
    </ul>
  </li>
  <li>Calculer <script type="math/tex">\texttt{(apply f v)}</script></li>
</ul>

<h3 id="application--textttapply-f-v">Application : <script type="math/tex">\texttt{(apply f v)}</script></h3>

<p>Avec</p>
<ul>
  <li><script type="math/tex">f</script> : fermeture de la fonction à appliquer</li>
  <li><script type="math/tex">v</script> : liste des valeurs des arguments</li>
</ul>

<ol>
  <li>Soient <script type="math/tex">e</script> l’environnement lexical de <script type="math/tex">f</script>, <script type="math/tex">If</script> la liste des paramètres
  formels et <script type="math/tex">c</script> le corps de la fermeture</li>
  <li>Construire l’environnement local <script type="math/tex">e-local</script> constitué des liaisons entre les
  paramètres formels de <script type="math/tex">If</script> et les références des valeurs correspondantes
  dans <script type="math/tex">v</script></li>
  <li>Pour la suite d’expressions <script type="math/tex">expr</script> du corps <script type="math/tex">c</script> de <script type="math/tex">f</script> faire
  <script type="math/tex">\texttt{(eval expr (cons e-local e))}</script></li>
  <li>Renvoyer le résultat de l’évaluation de la dernière expression de <script type="math/tex">c</script></li>
</ol>

<h3 id="évaluation-paresseuse">Évaluation paresseuse</h3>

<p>L’évaluation paresseuse ou par nécessité consiste à retarder l’évaluation des
paramètres jusqu’au moment de leur utilisation. Éventuellement, certains
paramètres ne sont pas évalués dans certains cas. Ce mécanisme est nécessaire
pour implémenter les conditionnelles et dans les boucles</p>

<h3 id="replacement-textuel">Replacement textuel</h3>

<p>Il y a deux niveau de substitutions  l’appel d’une macro est substitué par la
définition de la macro dans laquelle les paramètres formels ont été substitués
par les arguments donnés lors de l’appel. Toutes ces substitutions sont
textuelles. Ainsi, la structure syntaxique n’est pas prise en compte. En C, les
macro-fonction fonctionnent de cette façon. Pour éviter certains pièges
syntaxiques, il faut respecter des règles d’écriture des macros (paramètre entre
parenthèses, corps entre parenthèses)</p>

<h2 id="-macroexpensions-par-transformation-de-source"><i class="fas fa-code-branch"></i> Macroexpensions par transformation de source</h2>

<p>En lisp et en scheme, les macroexpensions fonctionnent par transformation de
source, en tenant compte de la syntaxe. Elles permettent d’écrire ces formes
dites spéciales dont l’évaluation n’est pas applicative. Les arguments sont
évalués sur demande (en lisp) ou par nécessité (en scheme).</p>

<script type="math/tex; mode=display">% <![CDATA[
\texttt{(define-syntax-rule <pattern> <template>)} %]]></script>

<ul>
  <li><script type="math/tex">% <![CDATA[
<pattern> %]]></script> : <script type="math/tex">% <![CDATA[
\texttt{(<nom>-<macro> <p_1> ...)} %]]></script></li>
  <li><script type="math/tex">% <![CDATA[
<p_1> %]]></script> : variables de la macro</li>
  <li><script type="math/tex">% <![CDATA[
<template> %]]></script> : expressions</li>
  <li>Replacement des variables dans le template</li>
  <li>Le résultat est une forme</li>
  <li>Évaluation de la forme dans l’environnement d’appel</li>
</ul>
</div>
	</article>
</div><!-- Footer -->
<div id="footer">
  
  <!-- Copyright -->
  <ul class="copyright">
    
      <li>&copy;Informatique. All rights reserved.</li>
    
    <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
    <li>Jekyll integration: <a href="https://chrisbobbe.github.io/">Chris Bobbe</a></li>
  </ul>
  
</div></body>
</html>